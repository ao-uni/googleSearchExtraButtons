<!doctype html>
<html>
<head><meta charset="UTF-8"><title>localStorage saving</title>
	<script>
		var listen = window.addEventListener;
		(listen||window.attachEvent)((listen ?'':'on') +'message', function(ev){
			var d = JSON.parse(ev.data)
					,tok = d.tok
					,key = d.key, ns ='googXButtons_';
			switch(d.do){
				case 'set':
					var prev = localStorage[ns + key];
					localStorage[ns + key] = JSON.stringify(d.val); break;
				case 'get':
					prev = localStorage[ns + key];
					prev = prev !== undefined && !(typeof prev =='string'&&prev[0]=='{')? JSON.parse(prev) : prev; break;
				case 'remove':
					prev = localStorage[ns + key];
					if(prev !==undefined)
						localStorage.removeItem(ns + key);
			}
			console.log('[io2]', tok, 'prev=', prev);
			ev.source.postMessage(JSON.stringify(prev !==undefined ? {tok: tok, prev: prev} : {tok: tok, undef:1}), ev.origin);
		},!1);
	</script>
</head>
<body>
	This page supports saving of localStorage (on the domain github.io) for sites which erase it on its own domain (such as google.*, facebook.com etc.).
</body>
</html>